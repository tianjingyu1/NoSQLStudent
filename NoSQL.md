# 关系型数据库

采用关系模型来组织数据的数据库。

关系模型就是二维表格模型，而一个关系型数据库就是由二维表及其之间的联系所组成的一个数据组织。

代表产品：Oracle，Acess、SQL Server、MySQL、……

## 关系数据库的优点

1. 容易理解

二维表结构是非常贴近逻辑世界的一个概念，关系模型相对网状、层次等其他模型来说更容易理解

2. 使用方便

通用的SQL语言使得操作关系型数据库非常方便

3. 易于维护

丰富的完整性(实体完整性、参照完整性和用户定义的完整性)大大减低了数据冗余和数据不一致的概率
关系型数据库的价值

## 关系型数据库的价值

1）获取持久化数据
2）并发
3）集成
4）近乎标准的模型

### NoSQL面临的问题

  （1）传统大型关系型数据库无法很好地解决问题
  （2）在互联网上的应用
  （3）超大规模集中时间段在线访问和业务处理
  （4）产生海量数据（大数据）

### NoSQL技术的产生根源和主要应用场景：

(1)解决传统关系型数据库无法解决的数据存储及访问问题；
(2)要解决大数据应用问题；
(3)要解决互联网上应用问题。

### 纵向扩展

纵向扩展：需要功能更大的计算机，要购买更多的处理器、磁盘存储空间和内存。
但是机器的功能越强，其成本也越高，其扩展尺度也有限。

### 横向扩展

横向扩展：采用由多个小型计算机组成的集群，集群中的小型机可以使用性价比较高的硬件。
这样能降低扩展所需要的成本，而且，这么做也更有弹性：可以构建一个高度稳定的集群，就算其中的某些经常发生故障，也不会影响整个集群的运行。

### 横向扩展产生的问题：

1）在大型 企业向集群迁移的过程中，关系型数据库并不是设计给集群用的。
2）关系型数据库也可以把数据划分为几个集合，并将其分别放在各自独立的服务器上运行，于是就能有效地对数据库分片，这么做虽然能将负载分散到多个服务器之中，但是应用程序必须控制所有分片，它要知道数据库中的每份小数据都存放在哪个服务器才行。
3）关系型数据库：查询、参照完整性、事务、一致性控制等操作也都无法以跨分片的方式执行。

## NoSQL数据库所共同具备的特征：
1 ） NoSQL数据库不使用SQL
2） 它们通常都是开源项目
3） 大多数NoSQL数据库的研发动机，都是为了要在集群环境中运行
4）操作NoSQL数据库不需要使用“模式”，这样不用事先修改结构定义，即可自己添加字段了，在处理不规则数据和自定义字段时非常有用。

NoSQL技术主要解决以互联网业务应用为主的大数据应用问题。
重点要突出处理速度和海量数据的存储问题。

## NoSQL的优势

易扩展
NoSQL数据库种类繁多，但是一个共同的特点都是去掉关系数据库的关系型特性。数据之间无关系，这样就非常容易扩展。也无形之间，在架构的层面上带来了可扩展的能力。甚至有多种NoSQL之间的整合。

灵活的数据模型
NoSQL无需事先为要存储的数据建立字段，随时可以存储自定义的数据格式。而在关系数据库里，增删字段是一件非常麻烦的事情。如果是非常大数据量的表，增加字段简直就是一个噩梦。

高可用
NoSQL在不太影响性能的情况，就可以方便的实现高可用的架构。比如Cassandra，HBase模型，通过复制模型也能实现高可用。

大数据量，高性能
NoSQL数据库都具有非常高的读写性能，尤其在大数据量下，同样表现优秀。这得益于它的无关系性，数据库的结构简单。


最新的NoSQL官网对NoSQL的定义为：主体符合非关系型、分布式、开放源码和具有横向扩展能力的下一代数据库。

英文名称NoSQL：Not only  SQL
意即“不仅仅是SQL”。

### NewSQL 数据库

采用SQL标准，也具有关系数据库事务处理等特征，它们都是关系型数据库。
这样原先的关系数据库命名，甚至定义就有问题了。
为了加以区分，在原先的关系型数据库前加了“传统”两字，称之为“传统关系型数据库”。（TRDB,Traditional   Relational   Database）

## TRDB数据库

传统关系型数据库技术设计初始基于单机集中管理数据理念而进行的，所以受单机（一般指服务器）物理性能的限制。
如最大数据存储量及最大数据访问量是受硬盘、主板总线、内存、CPU的硬件最大性能指标所限制。

另外一个，传统关系型数据库技术都建立在集中的数据库管理系统（DBMS，Database Management System）上。也就是通过关系数据库系统处理数据，一般情况下只能在单机范围内实现，横向多机扩充（分布式应用）存在很大困难。

### 传统关系型数据库的主要技术特点：
（1）使用强存储模式技术。
（2）采用SQL技术标准来定义和操作数据库。
（3）采用强事务保证可用性及安全性。ACID
（4）主要采用单机集中式处理方式。

## NoSQL数据库

由于大数据问题的出现，催生了NoSQL技术的迅猛发展，它要弥补传统关系型数据库的技术缺陷——尤其在速度、存储量及多样化结构数据的处理的问题上。

一般对NoSQL技术从数据存储结构原理可以分键值存储、文档存储、列族存储、图存储、其他存储五种模式。

## NewSQL数据库

NewSQL是最近几年才出现的新的一种数据库技术。其出现的目的是为了结合传统关系型数据库与NoSQL数据库技术的优点，实现在大数据环境下的数据存储和处理。

从上述这句话可以看出NewSQL数据库设计者既要实现NoSQL技术快速、有效的大数据处理能力，又要实现传统关系数据库的SQL、事务处理等的优势。

### 各种NoSQL数据库的共同特性是：

不使用关系模型
在集群中运行良好
开源
适用于21世纪的互联网公司
无模式

# TRDB与NOSQL技术比较

### 单机的局限性

1. 传统关系型数据库系统设计之初主要基于一台服务器进行业务运行的。
受单机的硬件性能影响，所能提供的业务应用能力是受到严格限制；
最大性能不能超过单机硬件运行的极限。
极限包括了CPU、硬盘、主板、内存、网卡等的IO速度，硬盘、内存的存储空间等。

2. 核心瓶颈是硬盘，它的IO速度会比内存慢得多，而且自身再提高受物理性能限制，进展特别缓慢。另外，单硬盘的容量也是有限。

### 纵向扩充

产生了基于内存的NoSQL数据库产品，如Redis、FastDB、Memcached等。
主要解决数据处理速度问题。

### 横向扩充

采用多服务器，通过集群（Cluster）一起处理数据。

### 软件实现技术比较

数据库数据存储模式不一样，TRDB为强数据存储模式，NoSQL为弱数据存储模式；
分布式技术是NoSQL的核心技术思路，而TRDB以集中部署一台物理机为最初出发点；
TRDB的事务严格遵循ACID原则，而NoSQL遵循Base原则或者根本没有；
TRDB都遵循SQL操作标准，NoSQL没有统一的操作标准；
TRDB基于单机的硬盘数据处理技术为主，NoSQL基于分布式的或者内存数据处理技术为主；

去掉TRDB的严格约束，是NoSQL的技术建立思路之一
引入分布式管理软件系统是NoSQL技术建立思路之二
BASE事务，基本可用，允许数据偶尔出错。NoSQL技术建立思路之三

### 帽子定理（Cap   Theorem）
一致性(Consistency)
可用性（Avalibility）
分区容错性（Partition Tolerance）

一致性(Consistency)
指的是同一时刻，任何一个终端客户在每个节点都能读到最新写入的数据；核心要求至少两台服务器保存着一样的数据，一致性从客户角度是针对“读”。简单理解为同步数据复制功能。

可用性（Avalibility）
指的是一个运行的节点在合理的时间内总能相应更新请求，不会发生错误或超时；可用性从客户角度是针对“更新”。简单理解为满足随时更新操作功能。

分区容错性（Partition Tolerance）
指的是当 网络发生故障时，系统仍能继续保持相应客户读请求的能力。可以简单理解为满足随时读有效数据功能。

### 事务（Transaction）

TRDB在具体数据处理过程，经常需要用到事务处理功能，目的为了保证数据处理的ACID，即

原子性(A, Atomicity)
一致性（C, Consistency）
隔离性(I, Isolation)
持久性(D, Durability)。

处理数据类型不一样：NoSQL技术诞生那一刻，就定位于非结构性很强的数据，如网页、网站访问点击量、大量的视频存储、地理位置的最优路径处理、广告智能推送等。而这些数据允许插入出错，给客户带来的损失往往是可以接受的。

BASE：
基本可用(BA, Basically Available)
软状态(S, Soft State)
最终一致性(E, Soft State)

BASE：
基本可用(BA, Basically Available)
NoSQL允许分布式系统中某些部分出现故障时，系统的其余部分仍然可以继续运作。 ACID则要求系统出现故障，强制拒绝。

软状态(S, Soft State)
NoSQL在处理数据过程中，允许这个过程，存在数据状态暂时的不一致的情况。但经过纠错处理，最终会一致的。

最终一致性(E, Eventually   Consistent)
NoSQL 的 软状态允许数据处理过程状态的暂时不一致，但是最终结果将是一致的。

### SQL技术标准

SQL是TRDB标准配置技术之一，关系数据库的典型特征，属于高级语言的特征。
NoSQL技术发展到现在，已经公开的并被使用的，有２００多种数据库技术。相关的数据库存储及数据使用操作命令没有做到命名等的统一，这给学习、技术移植等带来了麻烦。后续NOSQL标准的统一是一种发展趋势。

### 分析技术

NoSQL技术的发展，解决了大数据的存储和分析问题，由此产生了更多的分析技术；
TRDB技术受制于服务器物理性能极限。

NoSQL技术的支持下，进行大数据分析相对TRDB来说具有很大优势，至少包括技术优势
和成本优势。

技术优势 NoSQL的快速大数据处理能力，为应用者提供了代码开发基础支持，使基于大数据分析更容易
成本优势 NoSQL 、Hadoop代码开源 

## 键值数据存储模式 Redis

1、数据存储结构最简单的一类NoSQL数据库

键值数据库（Key Value Database）

是一类轻量级结合内存处理为主的NoSQL数据库。

轻量级，指的是它的存储数据结构特别简单，数据库系统本身规模也比较小；说它以内存为主的运行处理，设计目的是为了更快地实现对大数据的处理。

也出现了以SSD为主的新型的键值数据库。

### 键值存储结构基本要素

1）   键（Key）
键起唯一索引值的作用，确保一个键值结构里数据记录的唯一性，同时也起信息记录的作用。

2） 值(Value)	
值是对应键相关的数据，通过键来获取，可以存放任何类型的数据。
键值数据库的值由BLOB(Binary Large object,二进制大对象)进行存储，
这意味着任何类型的数据都可以保存，键值数据库无预先定义数据类型的要求。
而预先定义存储数据类型在传统关系数据库里是强制要求的

3）  键值对（Key-Value Pair）
键和值的组合就形成了键值对，它们之间的关系是一对一影射的关系。
如“中国:上海:浦东”只能指向“浦东国际机场”这个值，而不能指向“虹桥机场”。

4）命名空间Namespace      桶(Bucket)
命名空间是由键值对所构成的集合。通常由一类键值对数据构成一个集合。访问方式：命名空间+键内容

对数据操作的实现是通过Put、Get和Delete实现的。

### 键值存储特点

1、键值存储设计优点:
    简单   例如：热门网页排行记录，或网页关注度
    快速    例如：处理上亿次的访问量
    高效计算     例如：购物平台推荐信息
2、缺点
    对值进行多值查找功能很弱    例如：范围查找，部分统计功能  
    缺少约束，意味着更容易出错   例如：价格
    不容易建立复杂关系

## 文档数据存储模式 MongoDB

文档数据库（Document   Database）

文档数据库与传统关系数据库一样，主流的也是建立在对磁盘的读写的基础上，对数据进行各种操作。

文档数据库的设计思路是针对传统数据库低效的操作性能，首先考虑的是读写性能，为此需要去掉各种传统数据库规则的约束。

### 文档数据库实现基本原理

一条文档记录，内含若干个成对的键值对。该数据格式叫JSON。

### 文档数据库存储结构基本要素

1、键值对（Key-Value Pair）
文档数据库数据存储结构基本形式为键值对形式，具体由数据和格式组成。
按照数据和格式的复杂程度，可以把键值对分为基本键值对、带结构键值对、多形结构键值对。

1）基本键值对
2）带结构键值对    
   把值带数组或嵌入文档的叫带结构键值对。

2、文档（Document）文档是由键值对所构成的有序集。

3、集合（Collection） 集合是由若干条文档构成的对象。

4、数据库(Database)
文档数据库，包含了若干个集合，在进行数据操作之前，必须指定数据库名。

### 基本数据操作方式

1、写Insert命令
DB.Books.insert({“BookID”:”100005”,”Name”:”《C语言》”,”Price”:”60”})

2、选Select命令
DB.Books.find({“Name”:”《C语言》”})

3、改Update命令
DB.Books.update({“Book_ID”:”100002”},{$set{“Price”:78}})

4、删Remove命令
DB.Books.remove({“Book_ID”:”100004”}) 

### 文档存储特点

1、文档存储的优点
    简单    没有数据存储结构定义要求
    相对高效      
    文档格式处理
    查询功能强大
    分布式处理

2、文档存储的缺点
    缺少约束
    数据出现冗余
    相对低效

## 列族数据存储模式 HBase、Cassandra

列族数据库（Column   Families Database）
列族数据库为了解决大数据存储问题，引入了分布式处理技术，为了提高数据操作效率，针对传统数据库的弱点，采用了去规则去约束化的思路。

### 列族数据库实现基本原理

传统关系型数据库与列族数据库 数据在硬盘上的存储方式比较：

传统关系型数据库：以行为基本单位的磁盘记录存储方式，且以行为单位进行读写。

列族数据库 ：以列为单位的磁盘记录存储方式，以列（列族）为单位进行读写。 磁盘存储寻道速度快，读取数据量相对较少。

### 列族数据库存储结构基本要素

命名空间（NameSpace）
命名空间是列族数据库的顶级数据库结构。相当于传统关系型数据库的表名。

行键（Row Key）
行键用来唯一确定列族数据库中不同行数据区别的标识符。作用与DRTB中的行主键作用类似。分区和排序的作用。

列族（Column Family）
由若干个列所构成的一个集合叫列族。

列（Column）
列是列族数据库里用来存放单个数值的数据结构。
列的每个值（Value）都附带时间戳（Time Stamp）。通过时间戳来区分值的不同版本。

### 列族存储特点

（1）擅长大数据处理
（2）对于命名空间、行键、列族需要预先定义，列无须提早定义，随时可以增加。
（3）在大数据应用环境下，管理复杂，必须借助各种高效的管理工具来监控系统的正常运行。
（4）Hadoop生态系统为基于列族的大数据分析，提供了各种开发工具。
（5）数据存储模式相对键值数据库、文档数据库要复杂。
（6）查询功能相对更加丰富
（7）高密集写入处理能力    每秒几百万次的并发插入能力。

##  图数据存储模式

“图”是指数学里的”图论(Graph Theory)”。
所谓的图论里的图，就是由是由若干给定的点及连接两点的线所构成的图形，这种图形通常用来描述某些事物之间的某种特定关系
用点代表事物，用连接两点的线表示相应两个事物间具有这种关系。

### 图的特点：

节点（Node）代表一个个事物实体，如上述的各个城市名称；

边（Edge）就是连接各个城市之间的铁路，表明实体之间的关系；
所谓无向，指铁路是可以双向通行的，不受方向限制，相关的边就是无向边（Undirected Edge）；相对无向边，就是有向边（Directed Edge）。
节点、边，都可以附加属性（Attribute）。

图存储是一个包含若干个节点、节点之间存在边关系，节点和边可以附加相关属性的结合系统，简称图（Graph）。

### 图数据库存储结构基本要素

（1）节点
（2）边
（3）属性
（4）图

### 图存储操作方式

对于单个节点，提供建立（Create）、删除（Delete）、更新（Update）、（移动Remove）、合并（Merge）等操作；
对于图，提供图的交集、图的并集、图的遍历等操作功能。

### 图存储特点

（1）处理各种具有图结构的数据
（2）应用领域相对明确
（3）以单台服务器运行的图数据库为主
（4）图偏重于查找、统计、分析应用
